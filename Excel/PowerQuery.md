[Top](../README.md) > [Excel](../Excel.md)

# PowerQuery
とりあえずまとめて書く<br>
きつくなってきたらM言語とビジュアル操作分ける<br>
[公式ドキュメント](https://learn.microsoft.com/ja-jp/power-query/)

## M言語
- let<br>
ステップ（変数）宣言<br>
先頭に「#」を加え、「"」で囲うことでスペースを含むステップ名を指定可能<br>
直前にコメント入れると「適用したステップ」該当箇所にカーソル合わせたときにコメント表示される
- in<br>
ステップ呼び出し

|機能|コード|備考|
|--|--|--|
|開いてるExcelファイル上のテーブルを表示|`Excel.CurrentWorkbook()`|「{[Name = "テーブル名"]}」で指定したテーブルの情報、そこからさらに「[Content]を加えることで指定したテーブルのデータ（コンテンツ）を表示できる」|
|指定したフィールドを指定したデータ型に変換|`Table.TransformColumnTypes(テーブル, {{"フィールド名1", type データ型1},{"フィールド名2", type データ型2},...})`|データ型はとりあえず「number」（整数）と「text」（文字列）を知っとけば基本は大丈夫そう|
|指定したフィールドが指定した値であるデータを選択|`Table.SelectRows(テーブル, each ([フィールド名1] = 値1 or [フィールド名2] = 値2 or ...) and ([フィールド名3] = 値3) and ...)`|andで別フィールドの条件（同時に満たす）、orで同一フィールドの条件（同時に満たさない）を追加できる|
|指定したフィールドのみ表示（選択）|`Table.SelectColumns(テーブル, {"フィールド名1", "フィールド名2", ...})`|-|
|リスト|`{データ1, データ2, データ3, ...}`|プレビュー上はテーブルと同様に表示される（フィールド名は「リスト」）<br>`変数名{インデックス番号}`でリスト内の任意の要素にアクセス可能|
|フィールドのセット|`[フィールド名1 = データ1, フィールド名2 = データ2, ...]`|`変数名[フィールド名]`でフィールドセット内の任意のフィールドに対応するデータにアクセス可能|
|テーブル|`#table({フィールド名A, フィールド名B, ...}, {{データA1, データB1, ...}, {データA2, データB2, ...}, ...})`|SQLのCREATE句と似たようなもん|
|自然対数の底|`Number.E`|-|
|指定した検索文字列が検索対象文字列に含まれる位置|`Text.PositionOf(検索対象文字列, 検索文字列)`|検索文字列が検索対象文字列に含まれていない場合は-1を返す|
